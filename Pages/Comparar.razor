@page "/comparar"

@inject ICalculadorImpostosProgressivos CalculadorImpostosProgressivos
@inject ICalculadorImpostosFlat CalculadorImpostosFlat

<h1>Comparação de vencimento líquido</h1>

<div style="padding: 1.5rem">
    <EditForm Model="DadosCalculo">
        <div class="form-group">
            <label for="inputVencimento">Vencimento Base</label>
            <input type="number" @bind="DadosCalculo.VencimentoBruto" class="form-control" id="inputVencimento" aria-describedby="ajudaVencimento">
            <small id="ajudaVencimento" class="form-text text-muted">Vencimento bruto mensal (vencimento anual / 14 meses)</small>
        </div>
        <button type="submit" class="btn btn-primary" @onclick="Calcular">Comparar</button>
    </EditForm>
</div>

<table class="table table-striped table-bordered">
    <thead class="thead-light">
        <tr>
            <th></th>
            <th scope="col" class="text-center">Flat Tax</th>
            <th scope="col" class="text-center">Progressivo</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th scope="row">Rendimento tributável</th>
            <td class="text-center">@($"{sumarioImpostosFlat.Tributavel:N2}€")</td>
            <td class="text-center">@($"{sumarioImpostosProgressivos.Tributavel:N2}€")</td>
        </tr>
        <tr>
            <th scope="row">Taxa de IRS</th>
            <td class="text-center">@($"{sumarioImpostosFlat.Taxa:P2}")</td>
            <td class="text-center">@($"{sumarioImpostosProgressivos.Taxa:P2}")</td>
        </tr>
        <tr>
            <th scope="row">Segurança Social</th>
            <td colspan="2" class="text-center">@($"-€{segurancaSocial:N2}")</td>
        </tr>
        <tr>
            <th scope="row">Retenção de IRS</th>
            <td class="text-center">@($"-{sumarioImpostosFlat.Retencao:N2}€")</td>
            <td class="text-center">@($"-{sumarioImpostosProgressivos.Retencao:N2}€")</td>
        </tr>
        <tr>
            <th scope="row">Vencimento Líquido</th>
            <td class="text-center"><strong>@($"{sumarioImpostosFlat.VencimentoLiquido - segurancaSocial:N2}€")</strong></td>
            <td class="text-center"><strong>@($"{sumarioImpostosProgressivos.VencimentoLiquido - segurancaSocial:N2}€")</strong></td>
        </tr>
        <tr>
            <th scope="row">Custo para a empresa</th>
            <td colspan="2" class="text-center">@($"{custoParaEmpresa:N2}€")</td>
        </tr>
    </tbody>
</table>

<h2 class="alert alert-success text-center">Aumento líquido mensal: @($"{sumarioImpostosFlat.VencimentoLiquido - sumarioImpostosProgressivos.VencimentoLiquido:N2}€")</h2>

@code {
    private DadosCalculo DadosCalculo = new DadosCalculo();

    private decimal segurancaSocial;
    private decimal custoParaEmpresa;

    private SumarioImpostos sumarioImpostosFlat = new SumarioImpostos();
    private SumarioImpostos sumarioImpostosProgressivos = new SumarioImpostos();

    private void Calcular()
    {
        segurancaSocial = DadosCalculo.VencimentoBruto * DadosCalculo.TaxaSegurancaSocial;
        custoParaEmpresa = DadosCalculo.VencimentoBruto + DadosCalculo.VencimentoBruto * DadosCalculo.TaxaSegurancaSocialEmpresa;
        sumarioImpostosProgressivos = CalculadorImpostosProgressivos.Calcular(DadosCalculo.VencimentoBruto, Localizacao.Continente, Categoria.TrabalhadorDependente, Situacao.NaoCasado, false, 0);
        sumarioImpostosFlat = CalculadorImpostosFlat.Calcular(DadosCalculo.VencimentoBruto);
    }

}